<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jinhe.modules.system.dao.SysUserMapper">

    <!--查询所有用户列表-->
    <select id="userList"  resultType="com.jinhe.modules.system.dto.SysUserDto">
        select sys_user.id, sys_user.NORMALIZED_USERNAME, sys_user.nick_Name,sys_organ.FULL_NAME as organ_name,sys_role.TAG as role_name,sys_user.CREATE_TIME from (sys_user left join sys_user_role on sys_user.id=sys_user_role.user_id LEFT JOIN sys_role on sys_user_role.ROLE_ID=sys_role.id)left join sys_user_organ on sys_user.id=sys_user_organ.user_id LEFT JOIN sys_organ on sys_user_organ.ORGAN_ID=sys_organ.id
    </select>

    <!--关键字查询-->
    <select id="selectByWords"  resultType="com.jinhe.modules.system.dto.SysUserDto">
        select sys_user.NORMALIZED_USERNAME, sys_user.nick_Name,sys_organ.FULL_NAME as organ_name,sys_role.TAG as role_name,sys_user.CREATE_TIME from (sys_user left join sys_user_role on sys_user.id=sys_user_role.user_id LEFT JOIN sys_role on sys_user_role.ROLE_ID=sys_role.id)left join sys_user_organ on sys_user.id=sys_user_organ.user_id LEFT JOIN sys_organ on sys_user_organ.ORGAN_ID=sys_organ.id where sys_organ.FULL_NAME like #{organName} and sys_role.TAG like #{roleName} and sys_user.NORMALIZED_USERNAME like #{normalizedUserName}
    </select>

    <!--查询被禁用户-->
<select id="disableUserList" resultType="com.jinhe.modules.system.dto.SysUserDto">
    select sys_user.id, sys_user.NORMALIZED_USERNAME, sys_user.nick_Name,sys_organ.FULL_NAME as organ_name,sys_role.TAG as role_name,sys_user.CREATE_TIME from (sys_user left join sys_user_role on sys_user.id=sys_user_role.user_id LEFT JOIN sys_role on sys_user_role.ROLE_ID=sys_role.id)left join sys_user_organ on sys_user.id=sys_user_organ.user_id LEFT JOIN sys_organ on sys_user_organ.ORGAN_ID=sys_organ.id where sys_user.state=1
</select>

    <!--重置密码-->
    <update id="updatePassword">
        update sys_user set passWord_hash=#{newPassword} where id=#{userId} and passWord_hash=#{oldPassword}
    </update>

    <!--禁用/恢复账户-->
    <update id="ableUserById">
        update sys_user set state=#{x} where id=#{userId}
    </update>

    <!--查询用户状态-->
   <select id="selectStateById" resultType="int">
       select state from sys_user where id=#{userId}
   </select>

     <!-- 删除用户-->
    <delete id="deleteUserById" parameterType="String">
        delete from sys_user where id=#{userId};
        delete from sys_user_role where user_id=#{userId};
        delete from sys_user_organ where user_id=#{userId};
    </delete>

</mapper>
